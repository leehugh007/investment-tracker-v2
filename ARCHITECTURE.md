# 投資追蹤系統 - 系統架構文件

## 📋 **系統概覽**

投資追蹤系統是一個多市場投資組合管理工具，支援美股、台股、港股、日股四個市場的投資追蹤和損益分析。

### **技術棧**
- **前端：** React 18 + Vite
- **樣式：** Tailwind CSS + Lucide React Icons
- **狀態管理：** React Hooks (useState, useEffect)
- **數據存儲：** LocalStorage
- **API 服務：** Finnhub (美股、台股)
- **部署：** Vercel (自動部署)

---

## ✅ **已實現功能**

### **1. 核心頁面結構**

#### **總覽頁面 (Dashboard)**
- ✅ 全市場投資組合統計
- ✅ 已實現損益和未實現損益分離顯示
- ✅ 各市場投資分佈
- ✅ 使用 `unifiedPnLCalculator` 統一計算邏輯

#### **美股頁面 (USMarket)**
- ✅ **6 張統計卡片：**
  1. 總市值 💰
  2. 總成本 📊
  3. 未實現損益 📈
  4. 總報酬率 🎯
  5. **已實現損益 💵** (新增)
  6. **已實現報酬率 📊** (新增)
- ✅ Finnhub API 自動股價更新
- ✅ 持股明細表格（可編輯價格）
- ✅ 交易記錄顯示
- ✅ 新增/賣出交易功能

#### **台股頁面 (TWMarket)**
- ✅ **6 張統計卡片：**（與美股相同結構）
  1. 總市值 💰
  2. 總成本 📊
  3. 未實現損益 📈
  4. 總報酬率 🎯
  5. **已實現損益 💵** (新增)
  6. **已實現報酬率 📊** (新增)
- ✅ Finnhub API 自動股價更新
- ✅ 持股明細表格（可編輯價格）
- ✅ 交易記錄顯示
- ✅ 新增/賣出交易功能

#### **港股頁面 (HKMarket)**
- ✅ **4 張統計卡片：**
  1. 總市值 💰
  2. 總成本 📊
  3. 未實現損益 📈
  4. 總報酬率 🎯
- ✅ 手動股價更新（點擊編輯）
- ✅ 持股明細表格
- ✅ 交易記錄顯示
- ✅ 新增交易功能（手動輸入公司名稱）

#### **日股頁面 (JPMarket)**
- ✅ **4 張統計卡片：**
  1. 總市值 💰
  2. 總成本 📊
  3. 未實現損益 📈
  4. 總報酬率 🎯
- ✅ 手動股價更新（點擊編輯）
- ✅ 持股明細表格
- ✅ 交易記錄顯示
- ✅ 新增交易功能（手動輸入公司名稱）

#### **分析頁面 (HistoryAnalysis)**
- ✅ 交易次數統計
- ✅ 總買入金額
- ✅ 總賣出金額
- ✅ **已實現損益計算** (修復完成)
- ✅ 篩選後的交易記錄

### **2. 核心組件**

#### **TransactionForm**
- ✅ 支援四個市場的交易新增
- ✅ 美股/台股：API 自動查詢公司名稱
- ✅ 港股/日股：手動輸入公司名稱
- ✅ 表單驗證和錯誤處理

#### **StockPriceUpdater**
- ✅ 批量股價更新（美股、台股）
- ✅ Finnhub API 整合
- ✅ 更新狀態顯示

#### **CardSummary**
- ✅ 統一的統計卡片組件
- ✅ 響應式設計
- ✅ 顏色狀態顯示（綠色/紅色）

### **3. 核心服務**

#### **unifiedPnLCalculator**
- ✅ 統一的損益計算邏輯
- ✅ FIFO 方法計算已實現損益
- ✅ 匯率轉換支援
- ✅ 多市場支援

#### **apiManager**
- ✅ Finnhub API 整合
- ✅ 美股和台股股價查詢
- ✅ 錯誤處理和重試機制

#### **LocalStorage 服務**
- ✅ 交易記錄存儲
- ✅ 股價數據存儲
- ✅ 數據持久化

### **4. UI/UX 特色**
- ✅ 響應式設計（手機、平板、桌面）
- ✅ 現代化卡片式 UI
- ✅ 直觀的顏色編碼（綠色盈利、紅色虧損）
- ✅ 流暢的導航體驗
- ✅ 即時數據更新

---

## 🔄 **待實現功能**

### **1. 港股和日股頁面完善**
- 🔄 **港股頁面：** 添加已實現損益和已實現報酬率統計卡片
- 🔄 **日股頁面：** 添加已實現損益和已實現報酬率統計卡片
- 🔄 統一所有市場頁面為 6 張統計卡片

### **2. API 功能擴展**
- 🔄 **港股 API 整合：** 研究並整合港股股價 API
- 🔄 **日股 API 整合：** 研究並整合日股股價 API
- 🔄 **即時股價更新：** WebSocket 或定時更新機制

### **3. 高級分析功能**
- 🔄 **投資組合分析：**
  - 資產配置圓餅圖
  - 市場分佈分析
  - 風險評估指標
- 🔄 **績效分析：**
  - 時間序列圖表
  - 年化報酬率
  - 夏普比率
  - 最大回撤
- 🔄 **比較分析：**
  - 與市場指數比較
  - 各市場績效對比

### **4. 數據可視化**
- 🔄 **圖表整合：** Chart.js 或 Recharts
- 🔄 **損益趨勢圖**
- 🔄 **持股分佈圖**
- 🔄 **交易歷史圖表**

### **5. 用戶體驗優化**
- 🔄 **數據導入/導出：**
  - CSV 格式支援
  - Excel 格式支援
  - 備份和還原功能
- 🔄 **通知系統：**
  - 價格警報
  - 損益提醒
- 🔄 **主題系統：**
  - 深色模式
  - 自定義主題

### **6. 技術優化**
- 🔄 **性能優化：**
  - 虛擬滾動（大量數據）
  - 懶加載
  - 緩存策略
- 🔄 **錯誤處理：**
  - 全局錯誤邊界
  - 離線支援
  - 數據恢復機制

### **7. 移動端優化**
- 🔄 **PWA 支援：**
  - 離線功能
  - 安裝提示
  - 推送通知
- 🔄 **觸控優化：**
  - 手勢支援
  - 觸控友好的 UI

### **8. 安全性和隱私**
- 🔄 **數據加密：** LocalStorage 數據加密
- 🔄 **用戶認證：** 可選的用戶登入系統
- 🔄 **雲端同步：** 跨設備數據同步

---

## 🏗️ **系統架構圖**

```
投資追蹤系統
├── 前端 (React + Vite)
│   ├── 頁面 (Pages)
│   │   ├── Dashboard (總覽)
│   │   ├── USMarket (美股)
│   │   ├── TWMarket (台股)
│   │   ├── HKMarket (港股)
│   │   ├── JPMarket (日股)
│   │   └── HistoryAnalysis (分析)
│   ├── 組件 (Components)
│   │   ├── TransactionForm
│   │   ├── StockPriceUpdater
│   │   └── CardSummary
│   └── 服務 (Services)
│       ├── unifiedPnLCalculator
│       ├── apiManager
│       └── LocalStorage
├── API 服務
│   └── Finnhub (美股、台股)
└── 部署
    └── Vercel (自動部署)
```

---

## 📝 **開發指南**

### **新增市場頁面**
1. 複製現有市場頁面結構
2. 修改市場標識和幣值顯示
3. 配置 API 或手動更新邏輯
4. 添加路由配置

### **新增統計功能**
1. 在 `unifiedPnLCalculator` 中添加計算邏輯
2. 在各市場頁面中添加 state 管理
3. 創建對應的統計卡片組件
4. 確保響應式設計

### **API 整合**
1. 在 `apiManager` 中添加新的 API 服務
2. 配置錯誤處理和重試機制
3. 更新 `StockPriceUpdater` 組件
4. 測試 API 限制和性能

---

## 🚀 **部署流程**

1. **開發：** 本地開發和測試
2. **推送：** Git 推送到 GitHub
3. **自動部署：** Vercel 自動觸發部署
4. **驗證：** 檢查部署結果和功能

---

## 📊 **當前狀態總結**

- **完成度：** ~85%
- **核心功能：** ✅ 完成
- **UI/UX：** ✅ 完成
- **API 整合：** 🔄 部分完成（美股、台股）
- **高級功能：** 🔄 待開發

系統已具備完整的投資追蹤核心功能，可以正常使用。後續開發主要集中在功能擴展和用戶體驗優化。

